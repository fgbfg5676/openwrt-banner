name: æ›´æ–°æ¨ªå¹…å†…å®¹

on:
  workflow_dispatch:
    inputs:
      banner_text:
        description: 'æ¨ªå¹…æ–‡å­—å†…å®¹ï¼ˆæ”¯æŒ\næ¢è¡Œï¼‰'
        required: true
        default: 'ğŸ‰ æ¬¢è¿ä½¿ç”¨å®šåˆ¶OpenWrtå›ºä»¶ï¼\nğŸ“± ä¸“ä¸šæŠ€æœ¯æ”¯æŒ\nğŸ’¬ æœ‰é—®é¢˜éšæ—¶è”ç³»'
      banner_color:
        description: 'é€‰æ‹©æ–‡å­—é¢œè‰²'
        required: true
        default: '#FF0000'
        type: choice
        options:
        - '#FF0000'  # çº¢è‰²
        - '#00FF00'  # ç»¿è‰²
        - '#0000FF'  # è“è‰²
        - '#FF6600'  # æ©™è‰²
        - '#800080'  # ç´«è‰²
        - '#000000'  # é»‘è‰²

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write   # âœ… å…è®¸å†™å…¥ä»“åº“å†…å®¹
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}   # âœ… ä½¿ç”¨ GitHub è‡ªåŠ¨æ³¨å…¥çš„ Token
    
    - name: æ›´æ–° banner.json
      run: |
        echo "æ­£åœ¨æ›´æ–°æ¨ªå¹…å†…å®¹..."
        echo "æ–‡å­—: ${{ github.event.inputs.banner_text }}"
        echo "é¢œè‰²: ${{ github.event.inputs.banner_color }}"

        # ç”Ÿæˆ JSON æ–‡ä»¶
        cat > banner.json << EOF
        {
          "text": "${{ github.event.inputs.banner_text }}",
          "color": "${{ github.event.inputs.banner_color }}"
        }
        EOF

        echo "ç”Ÿæˆçš„ banner.json å†…å®¹:"
        cat banner.json

    - name: æäº¤æ›´æ”¹
      run: |
        git config user.name "æ¨ªå¹…è‡ªåŠ¨æ›´æ–°æœºå™¨äºº"
        git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git add banner.json
        
        if ! git diff --staged --quiet; then
          git commit -m "ğŸ”„ æ›´æ–°æ¨ªå¹…å†…å®¹ - $(date '+%Y-%m-%d %H:%M:%S')"
          git push origin HEAD:main
          echo "âœ… æ¨ªå¹…å†…å®¹æ›´æ–°æˆåŠŸ!"
        else
          echo "â„¹ï¸ å†…å®¹æ— å˜åŒ–ï¼Œè·³è¿‡æ›´æ–°"
        fi
